---
title: "The Ridge Regression"
author: "Qi Tan"
output: html_document
---

<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{The ridge regression vignette}
-->

## The ridge regression
Calculate the out-of-sample mean square error as $\lambda$ varies.

```{r}
library(bis557)
data(ridge_train)
data(ridge_test)

#Predict fitted value
predict.ridge_reg <- function(object, ...) {
  newdata <- list(...)[[1]] #Give the actual objects
  m <- model.matrix(object$formula, newdata)
  m %*% object$coefficients
}

#Scale training set and test set separately
ridge_train_scale <- data.frame(cbind(ridge_train$y, scale(ridge_train[,-1])))
ridge_test_scale <- data.frame(cbind(ridge_test$y, scale(ridge_test[,-1])))

lambda_seq <- seq(0, 100, by=0.1)
mse <- rep(NA, length(lambda_seq))
result <- data.frame(cbind(lambda_seq, mse))

#Calculate mse
for (i in 1:length(result$mse)) {
  fit <- ridge_reg(V1~., result$lambda_seq[i], ridge_train_scale)
  error <- ridge_test_scale$V1 - predict.ridge_reg(fit, ridge_test_scale)
  result$mse[i] <- mean(error^2)
}

#Select lambda to minimize mse
result$lambda_seq[result$mse==min(result$mse)]

#Plot mse over lambda
plot(result$lambda_seq, result$mse)
```
$\lambda=27.4$ to minimize out-of-sample mse.